name: Release Buildï¼ˆå‘å¸ƒæ„å»ºï¼‰

permissions:
  contents: write

on:
  release:
    types: [ created ]  # å½“åˆ›å»ºæ–°çš„ Release æ—¶è§¦å‘
  workflow_dispatch: { }  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

env:
  JAVA_VERSION: '17'
  JAVA_DISTRIBUTION: 'jetbrains'  # ä½¿ç”¨ JetBrains Runtimeï¼ˆJBRï¼‰ï¼Œä¸º Swing åº”ç”¨ä¼˜åŒ–
  JLINK_MODULES: 'java.base,java.desktop,java.logging,jdk.unsupported,java.naming,java.net.http,java.prefs,java.sql,java.security.sasl,java.security.jgss,jdk.crypto.ec,java.management,java.management.rmi,jdk.crypto.cryptoki'
  # é€šç”¨ Java é€‰é¡¹ï¼ˆæ‰€æœ‰å¹³å°å…±äº«ï¼‰
  JAVA_OPTIONS_COMMON: '-Xms512m|-Xmx1g|-XX:MaxMetaspaceSize=256m|-XX:MetaspaceSize=128m|-XX:MaxDirectMemorySize=256m|-XX:+UseG1GC|-XX:MaxGCPauseMillis=200|-XX:InitiatingHeapOccupancyPercent=45|-XX:+UseStringDeduplication|-XX:+HeapDumpOnOutOfMemoryError|-XX:HeapDumpPath=./dumps|-Dfile.encoding=UTF-8|-Dswing.aatext=true|-Djava.net.preferIPv4Stack=true|-Dhttp.keepAlive=true'
  # Windows ç‰¹å®šé€‰é¡¹
  JAVA_OPTIONS_WINDOWS: '-Djavax.accessibility.assistive_technologies='
  # macOS ç‰¹å®šé€‰é¡¹
  JAVA_OPTIONS_MACOS: '-Dsun.java2d.metal=true|-Dapple.awt.application.appearance=system|--add-opens java.desktop/java.awt=ALL-UNNAMED|--add-opens java.desktop/sun.lwawt=ALL-UNNAMED|--add-opens java.desktop/sun.lwawt.macosx=ALL-UNNAMED|--add-exports java.desktop/com.apple.eawt=ALL-UNNAMED'
  # Linux ç‰¹å®šé€‰é¡¹
  JAVA_OPTIONS_LINUX: '-Dawt.useSystemAAFontSettings=on|--add-opens=java.desktop/sun.awt.X11=ALL-UNNAMED'

jobs:
  # æå–ç‰ˆæœ¬å·ï¼Œä¾›æ‰€æœ‰ job å¤ç”¨
  get-version:
    name: Get Versionï¼ˆè·å–ç‰ˆæœ¬å·ï¼‰
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.extract_version.outputs.version }}
    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          cache: 'maven'
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract versionï¼ˆæå–ç‰ˆæœ¬å·ï¼‰
        id: extract_version
        run: |
          VERSION=$(mvn help:evaluate -Dexpression=project.version -q -DforceStdout)
          echo "Version: $VERSION"
          echo "version=$VERSION" >> $GITHUB_OUTPUT

  # æ„å»º Fat JARï¼ˆè·¨å¹³å°ï¼‰ï¼Œä¾›æ‰€æœ‰å¹³å°å¤ç”¨
  build-jar-artifact:
    name: Build Fat JARï¼ˆæ„å»ºè·¨å¹³å° JARï¼‰
    runs-on: ubuntu-latest
    needs: [ get-version ]
    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          cache: 'maven'
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Build with Mavenï¼ˆä½¿ç”¨ Maven æ„å»º Fat JARï¼‰
        run: mvn -B clean package -DskipTests

      - name: Upload JAR for reuseï¼ˆä¸Šä¼  JAR ä¾›å…¶ä»– job å¤ç”¨ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: app-jar
          path: target/easy-postman-${{ needs.get-version.outputs.version }}.jar
          retention-days: 1


  build-windows-portable:
    name: Build Windows Portableï¼ˆæ„å»º Windows ç»¿è‰²ç‰ˆï¼‰
    runs-on: windows-latest
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º Windows ç²¾ç®€ JREï¼‰
        shell: pwsh
        run: |
          $runtimeDir = "target\runtime"
          if (Test-Path $runtimeDir) { Remove-Item -Recurse -Force $runtimeDir }
          
          jlink `
            --add-modules $env:JLINK_MODULES `
            --strip-java-debug-attributes `
            --strip-native-commands `
            --strip-debug `
            --no-header-files `
            --no-man-pages `
            --compress=2 `
            --verbose `
            --output $runtimeDir
          
          # éªŒè¯ JRE å¤§å°
          $size = (Get-ChildItem -Path $runtimeDir -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
          Write-Host "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $([math]::Round($size, 2)) MB"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarNameWithVersion = "easy-postman-$version.jar"
          $jarName = "easy-postman.jar"
          
          $distInputDir = "target\dist-input"
          if (Test-Path $distInputDir) { Remove-Item -Recurse -Force $distInputDir }
          New-Item -ItemType Directory -Path $distInputDir | Out-Null
          Copy-Item "target\$jarNameWithVersion" -Destination "$distInputDir\$jarName"

      - name: Create app-image with jpackageï¼ˆåˆ›å»ºåº”ç”¨é•œåƒï¼Œå…å®‰è£…ï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarName = "easy-postman.jar"
          $appImageDir = "target\app-image"
          
          if (Test-Path $appImageDir) { Remove-Item -Recurse -Force $appImageDir }
          
          # è§£æé€šç”¨ Java é€‰é¡¹
          $javaOptsCommon = $env:JAVA_OPTIONS_COMMON -split '\|'
          # è§£æ Windows ç‰¹å®šé€‰é¡¹
          $javaOptsWindows = $env:JAVA_OPTIONS_WINDOWS -split '\|'
          
          # æ„å»º jpackage å‚æ•°åˆ—è¡¨
          $jpackageArgs = @(
            '--type', 'app-image',
            '--input', 'target\dist-input',
            '--main-jar', $jarName,
            '--main-class', 'com.laker.postman.App',
            '--runtime-image', 'target\runtime',
            '--dest', 'target',
            '--icon', 'assets\win\EasyPostman.ico',
            '--name', 'EasyPostman',
            '--app-version', $version,
            '--vendor', 'Laker',
            '--copyright', 'Â© 2025 Laker'
          )
          
          # æ·»åŠ é€šç”¨ Java é€‰é¡¹
          foreach ($opt in $javaOptsCommon) {
            $jpackageArgs += '--java-options'
            $jpackageArgs += $opt
          }
          
          # æ·»åŠ  Windows ç‰¹å®šé€‰é¡¹
          foreach ($opt in $javaOptsWindows) {
            if ($opt -ne '') {
              $jpackageArgs += '--java-options'
              $jpackageArgs += $opt
            }
          }
          
          # æ‰§è¡Œ jpackage
          & jpackage @jpackageArgs

      - name: Package portable versionï¼ˆæ‰“åŒ…ç»¿è‰²ç‰ˆä¸º ZIPï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $appImageDir = "target\EasyPostman"
          $zipName = "EasyPostman-$version-windows-x64-portable.zip"
          
          if (-not (Test-Path "dist")) { New-Item -ItemType Directory -Path "dist" | Out-Null }
          
          # åˆ›å»º .portable æ ‡è¯†æ–‡ä»¶ï¼Œç”¨äºè¿è¡Œæ—¶æ£€æµ‹ä¾¿æºç‰ˆ
          $portableMarker = Join-Path $appImageDir ".portable"
          "This is a portable version" | Out-File -FilePath $portableMarker -Encoding UTF8
          Write-Host "Created .portable marker file"
          
          # å‹ç¼©ä¸º ZIP
          Compress-Archive -Path $appImageDir -DestinationPath "dist\$zipName" -Force
          
          Write-Host "âœ… Created portable version: $zipName"

      - name: Upload as Artifactï¼ˆä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Windows-Portable
          path: dist/*-portable.zip
          retention-days: 7


  build-windows-exe:
    name: Build Windows EXE Installerï¼ˆæ„å»º Windows EXE å®‰è£…ç¨‹åºï¼‰
    runs-on: windows-latest
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Install Inno Setupï¼ˆå®‰è£… Inno Setupï¼‰
        shell: pwsh
        run: |
          Write-Host "ğŸ“¦ Installing Inno Setup..."
          choco install innosetup -y --no-progress
          
          # åˆ·æ–°ç¯å¢ƒå˜é‡
          $env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")
          
          # éªŒè¯å®‰è£…
          $iscc = Get-Command iscc -ErrorAction SilentlyContinue
          if ($iscc) {
            Write-Host "âœ… Inno Setup installed: $($iscc.Source)"
            # æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼ˆiscc ä¸å¸¦å‚æ•°ä¼šæ˜¾ç¤ºç‰ˆæœ¬å’Œå¸®åŠ©ï¼‰
            & iscc 2>&1 | Select-Object -First 5
          } else {
            Write-Error "âŒ Inno Setup installation failed"
            exit 1
          }

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º Windows ç²¾ç®€ JREï¼‰
        shell: pwsh
        run: |
          $runtimeDir = "target\runtime"
          if (Test-Path $runtimeDir) { Remove-Item -Recurse -Force $runtimeDir }
          
          jlink `
            --add-modules $env:JLINK_MODULES `
            --strip-java-debug-attributes `
            --strip-native-commands `
            --strip-debug `
            --no-header-files `
            --no-man-pages `
            --compress=2 `
            --verbose `
            --output $runtimeDir
          
          # éªŒè¯ JRE å¤§å°
          $size = (Get-ChildItem -Path $runtimeDir -Recurse | Measure-Object -Property Length -Sum).Sum / 1MB
          Write-Host "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $([math]::Round($size, 2)) MB"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarNameWithVersion = "easy-postman-$version.jar"
          $jarName = "easy-postman.jar"
          
          $distInputDir = "target\dist-input"
          if (Test-Path $distInputDir) { Remove-Item -Recurse -Force $distInputDir }
          New-Item -ItemType Directory -Path $distInputDir | Out-Null
          Copy-Item "target\$jarNameWithVersion" -Destination "$distInputDir\$jarName"

      - name: Create app-image with jpackageï¼ˆåˆ›å»ºåº”ç”¨é•œåƒï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $jarName = "easy-postman.jar"
          
          # è§£æé€šç”¨ Java é€‰é¡¹
          $javaOptsCommon = $env:JAVA_OPTIONS_COMMON -split '\|'
          # è§£æ Windows ç‰¹å®šé€‰é¡¹
          $javaOptsWindows = $env:JAVA_OPTIONS_WINDOWS -split '\|'
          
          # æ„å»º jpackage å‚æ•°åˆ—è¡¨
          $jpackageArgs = @(
            '--type', 'app-image',
            '--input', 'target\dist-input',
            '--main-jar', $jarName,
            '--main-class', 'com.laker.postman.App',
            '--runtime-image', 'target\runtime',
            '--dest', 'target',
            '--icon', 'assets\win\EasyPostman.ico',
            '--name', 'EasyPostman',
            '--app-version', $version,
            '--vendor', 'Laker',
            '--copyright', 'Â© 2025 Laker'
          )
          
          # æ·»åŠ é€šç”¨ Java é€‰é¡¹
          foreach ($opt in $javaOptsCommon) {
            $jpackageArgs += '--java-options'
            $jpackageArgs += $opt
          }
          
          # æ·»åŠ  Windows ç‰¹å®šé€‰é¡¹
          foreach ($opt in $javaOptsWindows) {
            if ($opt -ne '') {
              $jpackageArgs += '--java-options'
              $jpackageArgs += $opt
            }
          }
          
          # æ‰§è¡Œ jpackage
          & jpackage @jpackageArgs
          
          Write-Host "âœ… App image created at: target\EasyPostman"

      - name: Create EXE with Inno Setupï¼ˆä½¿ç”¨ Inno Setup åˆ›å»º EXE å®‰è£…ç¨‹åºï¼‰
        shell: pwsh
        run: |
          $version = "${{ needs.get-version.outputs.version }}"
          $issScript = "build\easy-postman.iss"
          $arch = "x64"  # å½“å‰æ„å»ºä¸º x64ï¼Œæœªæ¥å¯æ‰©å±•ä¸º arm64
          
          # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
          if (-not (Test-Path "dist")) { 
            New-Item -ItemType Directory -Path "dist" | Out-Null 
          }
          
          Write-Host "ğŸ”¨ Building EXE installer with Inno Setup..."
          Write-Host "   Version: $version"
          Write-Host "   Architecture: $arch"
          Write-Host "   Script: $issScript"
          Write-Host "   Source: target\EasyPostman"
          
          # éªŒè¯æºç›®å½•å­˜åœ¨
          if (-not (Test-Path "target\EasyPostman")) {
            Write-Error "âŒ Source directory not found: target\EasyPostman"
            exit 1
          }
          
          # è¿è¡Œ Inno Setup ç¼–è¯‘å™¨
          # æ³¨æ„ï¼šè·¯å¾„ç›¸å¯¹äº ISS è„šæœ¬ä½ç½®ï¼ˆbuild ç›®å½•ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ ..\
          & iscc `
            "/DMyAppVersion=$version" `
            "/DMyAppSourceDir=..\target\EasyPostman" `
            "/DMyOutputDir=..\dist" `
            "/DMyArch=$arch" `
            $issScript
          
          if ($LASTEXITCODE -ne 0) {
            Write-Error "âŒ Inno Setup compilation failed with exit code: $LASTEXITCODE"
            exit 1
          }
          
          # éªŒè¯ EXE æ–‡ä»¶
          $expectedExeName = "EasyPostman-$version-windows-$arch.exe"
          $exeFile = Get-Item "dist\$expectedExeName" -ErrorAction SilentlyContinue
          
          if ($exeFile) {
            Write-Host "âœ… EXE installer created successfully!"
            Write-Host "   File: $($exeFile.Name)"
            Write-Host "   Size: $([math]::Round($exeFile.Length / 1MB, 2)) MB"
            Write-Host "   Path: $($exeFile.FullName)"
          } else {
            Write-Error "âŒ Expected EXE file not found: $expectedExeName"
            Write-Host "Files in dist folder:"
            Get-ChildItem "dist" | ForEach-Object { Write-Host "  - $($_.Name)" }
            exit 1
          }

      - name: Upload as Artifactï¼ˆä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Windows-EXE
          path: dist/*.exe
          retention-days: 7

  build-macos-intel:
    name: Build macOS Intel DMGï¼ˆæ„å»º macOS Intel ç‰ˆå®‰è£…åŒ…ï¼‰
    runs-on: macos-15-intel  # Intel x86_64
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º macOS Intel ç²¾ç®€ JREï¼‰
        run: |
          rm -rf target/runtime
          # åˆ›å»º macOS Intel å¹³å°çš„ JRE
          jlink \
            --add-modules ${{ env.JLINK_MODULES }} \
            --strip-java-debug-attributes \
            --strip-native-commands \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --verbose \
            --output target/runtime
          
          # éªŒè¯ JRE å¤§å°
          echo "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $(du -sh target/runtime | cut -f1)"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          rm -rf target/dist-input
          mkdir -p target/dist-input
          cp target/easy-postman-$VERSION.jar target/dist-input/easy-postman.jar

      - name: Create DMG with jpackageï¼ˆä½¿ç”¨ jpackage åˆ›å»º DMG é•œåƒï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          mkdir -p dist
          
          # è§£æé€šç”¨ Java é€‰é¡¹
          IFS='|' read -ra JAVA_OPTS_COMMON <<< "${{ env.JAVA_OPTIONS_COMMON }}"
          # è§£æ macOS ç‰¹å®šé€‰é¡¹
          IFS='|' read -ra JAVA_OPTS_MACOS <<< "${{ env.JAVA_OPTIONS_MACOS }}"
          
          # æ„å»º jpackage å‚æ•°æ•°ç»„
          JPACKAGE_ARGS=(
            --input target/dist-input
            --main-jar "easy-postman.jar"
            --main-class com.laker.postman.App
            --runtime-image target/runtime
            --type dmg
            --name "EasyPostman"
            --app-version "$VERSION"
            --dest dist
            --icon assets/mac/EasyPostman.icns
            --vendor "Laker"
            --copyright "Â© 2025 Laker"
          )
          
          # æ·»åŠ é€šç”¨ Java é€‰é¡¹
          for opt in "${JAVA_OPTS_COMMON[@]}"; do
            JPACKAGE_ARGS+=(--java-options "$opt")
          done
          
          # æ·»åŠ  macOS ç‰¹å®šé€‰é¡¹
          for opt in "${JAVA_OPTS_MACOS[@]}"; do
            if [ -n "$opt" ]; then
              JPACKAGE_ARGS+=(--java-options "$opt")
            fi
          done
          
          # æ‰§è¡Œ jpackage
          jpackage "${JPACKAGE_ARGS[@]}"
          
          # é‡å‘½åä¸º Intel ç‰ˆæœ¬ï¼ˆä½¿ç”¨æ ‡å‡†æ¶æ„æ ‡è¯†ï¼‰
          mv dist/EasyPostman-$VERSION.dmg dist/EasyPostman-$VERSION-macos-x86_64.dmg
          echo "âœ… Created: EasyPostman-$VERSION-macos-x86_64.dmg"

      - name: Upload as Artifactï¼ˆä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-macOS-Intel-DMG
          path: dist/*-macos-x86_64.dmg
          retention-days: 7

  build-macos-arm:
    name: Build macOS Apple Silicon DMGï¼ˆæ„å»º macOS Apple Silicon ç‰ˆå®‰è£…åŒ…ï¼‰
    runs-on: macos-latest  # Apple Silicon (M1/M2/M3/M4)
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º macOS ARM ç²¾ç®€ JREï¼‰
        run: |
          rm -rf target/runtime
          # åˆ›å»º macOS ARM å¹³å°çš„ JRE
          jlink \
            --add-modules ${{ env.JLINK_MODULES }} \
            --strip-java-debug-attributes \
            --strip-native-commands \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --verbose \
            --output target/runtime
          
          # éªŒè¯ JRE å¤§å°
          echo "âœ… JRE åˆ›å»ºæˆåŠŸï¼Œå¤§å°: $(du -sh target/runtime | cut -f1)"

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          rm -rf target/dist-input
          mkdir -p target/dist-input
          cp target/easy-postman-$VERSION.jar target/dist-input/easy-postman.jar

      - name: Create DMG with jpackageï¼ˆä½¿ç”¨ jpackage åˆ›å»º DMG é•œåƒï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          mkdir -p dist
          
          # è§£æé€šç”¨ Java é€‰é¡¹
          IFS='|' read -ra JAVA_OPTS_COMMON <<< "${{ env.JAVA_OPTIONS_COMMON }}"
          # è§£æ macOS ç‰¹å®šé€‰é¡¹
          IFS='|' read -ra JAVA_OPTS_MACOS <<< "${{ env.JAVA_OPTIONS_MACOS }}"
          
          # æ„å»º jpackage å‚æ•°æ•°ç»„
          JPACKAGE_ARGS=(
            --input target/dist-input
            --main-jar "easy-postman.jar"
            --main-class com.laker.postman.App
            --runtime-image target/runtime
            --type dmg
            --name "EasyPostman"
            --app-version "$VERSION"
            --dest dist
            --icon assets/mac/EasyPostman.icns
            --vendor "Laker"
            --copyright "Â© 2025 Laker"
          )
          
          # æ·»åŠ é€šç”¨ Java é€‰é¡¹
          for opt in "${JAVA_OPTS_COMMON[@]}"; do
            JPACKAGE_ARGS+=(--java-options "$opt")
          done
          
          # æ·»åŠ  macOS ç‰¹å®šé€‰é¡¹
          for opt in "${JAVA_OPTS_MACOS[@]}"; do
            if [ -n "$opt" ]; then
              JPACKAGE_ARGS+=(--java-options "$opt")
            fi
          done
          
          # æ‰§è¡Œ jpackage
          jpackage "${JPACKAGE_ARGS[@]}"
          
          # é‡å‘½åä¸º ARM ç‰ˆæœ¬ï¼ˆä½¿ç”¨æ ‡å‡†æ¶æ„æ ‡è¯†ï¼‰
          mv dist/EasyPostman-$VERSION.dmg dist/EasyPostman-$VERSION-macos-arm64.dmg
          echo "âœ… Created: EasyPostman-$VERSION-macos-arm64.dmg"

      - name: Upload as Artifactï¼ˆä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-macOS-ARM-DMG
          path: dist/*-macos-arm64.dmg
          retention-days: 7

  build-jar:
    name: Build Standalone JARï¼ˆæ„å»ºç‹¬ç«‹ JAR åŒ…ï¼‰
    runs-on: ubuntu-latest
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Download JAR artifactï¼ˆä¸‹è½½å·²æ„å»ºçš„ JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: dist

      - name: Upload as Artifactï¼ˆä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Standalone-JAR
          path: dist/*.jar
          retention-days: 7

  build-ubuntu:
    name: Build Ubuntu DEBï¼ˆæ„å»º Ubuntu å®‰è£…åŒ…ï¼‰
    runs-on: ubuntu-22.04
    needs: [ get-version, build-jar-artifact ]

    steps:
      - name: Checkoutï¼ˆæ£€å‡ºä»£ç ï¼‰
        uses: actions/checkout@v4

      - name: Setup Javaï¼ˆé…ç½® Javaï¼‰
        uses: actions/setup-java@v4
        with:
          distribution: ${{ env.JAVA_DISTRIBUTION }}
          java-version: ${{ env.JAVA_VERSION }}
          check-latest: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Download Fat JARï¼ˆä¸‹è½½è·¨å¹³å° Fat JARï¼‰
        uses: actions/download-artifact@v4
        with:
          name: app-jar
          path: target

      - name: Install dependenciesï¼ˆå®‰è£…ç³»ç»Ÿä¾èµ–ï¼‰
        run: |
          sudo apt-get update
          # å®‰è£… GTK3ã€WebKit å’Œæ‰“åŒ…å·¥å…·
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev binutils

      - name: Create runtime with jlinkï¼ˆä½¿ç”¨ jlink åˆ›å»º Linux ç²¾ç®€ JREï¼‰
        run: |
          rm -rf target/runtime
          # åˆ›å»º Linux å¹³å°çš„ JRE
          jlink \
            --add-modules ${{ env.JLINK_MODULES }} \
            --strip-debug \
            --no-header-files \
            --no-man-pages \
            --compress=2 \
            --output target/runtime

      - name: Prepare dist-inputï¼ˆå‡†å¤‡æ‰“åŒ…è¾“å…¥ç›®å½•ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          rm -rf target/dist-input
          mkdir -p target/dist-input
          cp target/easy-postman-$VERSION.jar target/dist-input/easy-postman.jar

      - name: Create DEB with jpackageï¼ˆä½¿ç”¨ jpackage åˆ›å»º DEB å®‰è£…åŒ…ï¼‰
        run: |
          VERSION="${{ needs.get-version.outputs.version }}"
          mkdir -p dist
          
          # è§£æé€šç”¨ Java é€‰é¡¹
          IFS='|' read -ra JAVA_OPTS_COMMON <<< "${{ env.JAVA_OPTIONS_COMMON }}"
          # è§£æ Linux ç‰¹å®šé€‰é¡¹
          IFS='|' read -ra JAVA_OPTS_LINUX <<< "${{ env.JAVA_OPTIONS_LINUX }}"
          
          # æ„å»º jpackage å‚æ•°æ•°ç»„
          JPACKAGE_ARGS=(
            --input target/dist-input
            --main-jar "easy-postman.jar"
            --main-class com.laker.postman.App
            --runtime-image target/runtime
            --type deb
            --name "EasyPostman"
            --app-version "$VERSION"
            --dest dist
            --vendor "Laker"
            --copyright "Â© 2025 Laker"
            --description "A modern API testing tool similar to Postman"
            --linux-shortcut
            --linux-menu-group "Development"
            --linux-app-category "Development"
          )
          
          # æ·»åŠ é€šç”¨ Java é€‰é¡¹
          for opt in "${JAVA_OPTS_COMMON[@]}"; do
            JPACKAGE_ARGS+=(--java-options "$opt")
          done
          
          # æ·»åŠ  Linux ç‰¹å®šé€‰é¡¹
          for opt in "${JAVA_OPTS_LINUX[@]}"; do
            if [ -n "$opt" ]; then
              JPACKAGE_ARGS+=(--java-options "$opt")
            fi
          done
          
          # æ‰§è¡Œ jpackage
          jpackage "${JPACKAGE_ARGS[@]}"

      - name: Upload as Artifactï¼ˆä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©ï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: EasyPostman-Ubuntu-DEB
          path: dist/*.deb
          retention-days: 7

  # ============================================================
  # ç»Ÿä¸€ä¸Šä¼ æ‰€æœ‰å¹³å°æ–‡ä»¶åˆ° GitHub Release
  # ä½¿ç”¨ softprops/action-gh-release@v2ï¼Œè§¦å‘æ¡ä»¶ï¼šrelease äº‹ä»¶
  # always() ä¿è¯å³ä½¿éƒ¨åˆ†æ„å»ºå¤±è´¥ä¹Ÿèƒ½ä¸Šä¼ æˆåŠŸçš„æ–‡ä»¶
  # ============================================================
  upload-to-github-release:
    name: Upload All to GitHub Releaseï¼ˆç»Ÿä¸€ä¸Šä¼ åˆ° GitHub Releaseï¼‰
    if: github.event_name == 'release'
    needs: [ build-windows-portable, build-windows-exe, build-macos-intel, build-macos-arm, build-jar, build-ubuntu ]
    runs-on: ubuntu-latest
    steps:
      - name: Download all release artifactsï¼ˆä¸‹è½½æ‰€æœ‰å¹³å°æ„å»ºäº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          path: all-artifacts
          pattern: EasyPostman-*
          merge-multiple: true

      - name: List downloaded filesï¼ˆåˆ—å‡ºæ‰€æœ‰ä¸‹è½½æ–‡ä»¶ï¼‰
        run: |
          echo "ğŸ“¦ Downloaded artifacts:"
          find all-artifacts -type f | sort

      - name: Upload all files to GitHub Releaseï¼ˆä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ° Releaseï¼‰
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.event.release.tag_name }}
          files: |
            all-artifacts/*-portable.zip
            all-artifacts/*.exe
            all-artifacts/*-macos-x86_64.dmg
            all-artifacts/*-macos-arm64.dmg
            all-artifacts/*.jar
            all-artifacts/*.deb
          fail_on_unmatched_files: false
          overwrite_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ============================================================
  # æ£€æŸ¥æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªæ„å»ºæˆåŠŸï¼ˆç”¨äº Gitee åŒæ­¥å‰ç½®åˆ¤æ–­ï¼‰
  # ============================================================
  check-any-build-success:
    name: Check Any Build Successï¼ˆæ£€æŸ¥è‡³å°‘ä¸€ä¸ªæ„å»ºæˆåŠŸï¼‰
    if: |
      github.event_name == 'release' &&
      always()
    needs: [ build-windows-portable, build-windows-exe, build-macos-arm ]
    runs-on: ubuntu-latest
    outputs:
      should_create_release: ${{ steps.check.outputs.should_create }}

    steps:
      - name: Check if any build succeededï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•æ„å»ºæˆåŠŸï¼‰
        id: check
        run: |
          echo "ğŸ“Š æ£€æŸ¥æ„å»ºçŠ¶æ€..."
          echo "  Windows Portable: ${{ needs.build-windows-portable.result }}"
          echo "  Windows EXE: ${{ needs.build-windows-exe.result }}"
          echo "  macOS ARM: ${{ needs.build-macos-arm.result }}"
          
          # åªè¦æœ‰ä¸€ä¸ªæˆåŠŸå°±åˆ›å»º Release
          if [ "${{ needs.build-windows-portable.result }}" == "success" ] || \
             [ "${{ needs.build-windows-exe.result }}" == "success" ] || \
             [ "${{ needs.build-macos-arm.result }}" == "success" ]; then
            echo "âœ… è‡³å°‘æœ‰ä¸€ä¸ªæ„å»ºæˆåŠŸï¼Œå¯ä»¥åˆ›å»º Gitee Release"
            echo "should_create=true" >> $GITHUB_OUTPUT
          else
            echo "âŒ æ‰€æœ‰æ„å»ºéƒ½å¤±è´¥ï¼Œè·³è¿‡åˆ›å»º Gitee Release"
            echo "should_create=false" >> $GITHUB_OUTPUT
            exit 1
          fi

  # ============================================================
  # åˆ›å»º Gitee Release
  # ============================================================
  create-gitee-release:
    name: Create Gitee Releaseï¼ˆåˆ›å»º Gitee Releaseï¼‰
    if: github.event_name == 'release' && needs.check-any-build-success.outputs.should_create_release == 'true'
    needs: [ get-version, check-any-build-success ]
    runs-on: ubuntu-latest
    outputs:
      release_id: ${{ steps.gitee_release.outputs.release_id }}
      tag_name: ${{ steps.get_version.outputs.tag }}

    steps:
      - name: Get version from tagï¼ˆä»æ ‡ç­¾è·å–ç‰ˆæœ¬å·ï¼‰
        id: get_version
        run: |
          TAG_NAME="${{ github.event.release.tag_name }}"
          VERSION="${TAG_NAME#v}"
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "tag=$TAG_NAME" >> $GITHUB_OUTPUT

      - name: Create Gitee Releaseï¼ˆåˆ›å»º Gitee Releaseï¼‰
        id: gitee_release
        run: |
          VERSION="${{ steps.get_version.outputs.version }}"
          TAG_NAME="${{ steps.get_version.outputs.tag }}"
          RELEASE_BODY="${{ github.event.release.body }}"
          
          if [ -z "$RELEASE_BODY" ]; then
            RELEASE_BODY="EasyPostman ${VERSION} å‘å¸ƒç‰ˆæœ¬ï¼Œæ”¯æŒ Windowsã€macOS å’Œ Linuxã€‚è¯¦æƒ…ï¼šhttps://github.com/lakernote/easy-postman"
          fi
          
          echo "ğŸš€ Creating Gitee Release for tag: $TAG_NAME"
          
          # é‡è¯•æœºåˆ¶
          MAX_RETRIES=3
          RETRY_COUNT=0
          SUCCESS=false
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ] && [ "$SUCCESS" = false ]; do
            echo "â³ Attempt $((RETRY_COUNT + 1))/$MAX_RETRIES..."
          
            # ä½¿ç”¨æ›´å¥å£®çš„ curl é€‰é¡¹
            # --retry 3: curl å†…éƒ¨é‡è¯• 3 æ¬¡
            # --retry-delay 2: é‡è¯•é—´éš” 2 ç§’
            # --connect-timeout 30: è¿æ¥è¶…æ—¶ 30 ç§’
            # --max-time 60: æ•´ä½“è¶…æ—¶ 60 ç§’
            set +e  # ä¸´æ—¶ç¦ç”¨ exit on error
            HTTP_CODE=$(curl -w "%{http_code}" \
              --retry 3 \
              --retry-delay 2 \
              --connect-timeout 30 \
              --max-time 60 \
              -S -X POST \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "tag_name=$TAG_NAME" \
              -F "name=$TAG_NAME" \
              -F "body=$RELEASE_BODY" \
              -F "prerelease=false" \
              -F "target_commitish=master" \
              "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases" \
              -o /tmp/release.json 2>&1 | tail -n1)
            CURL_EXIT_CODE=$?
            set -e  # é‡æ–°å¯ç”¨ exit on error
          
            echo "curl exit code: $CURL_EXIT_CODE"
            echo "HTTP Status Code: $HTTP_CODE"
          
            if [ $CURL_EXIT_CODE -eq 0 ] && [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 300 ]; then
              SUCCESS=true
              echo "âœ… API call successful!"
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              if [ $RETRY_COUNT -lt $MAX_RETRIES ]; then
                echo "âš ï¸ Failed (curl: $CURL_EXIT_CODE, HTTP: $HTTP_CODE), retrying in 5 seconds..."
                sleep 5
              fi
            fi
          done
          
          if [ "$SUCCESS" = false ]; then
            echo "âŒ Failed to create Gitee Release after $MAX_RETRIES attempts"
            echo "Last curl exit code: $CURL_EXIT_CODE"
            echo "Last HTTP code: $HTTP_CODE"
            cat /tmp/release.json 2>/dev/null || echo "No response file"
            exit 1
          fi
          
          echo "API Response:"
          cat /tmp/release.json
          
          # ä¼˜å…ˆä½¿ç”¨ jqï¼ˆGitHub Actions Ubuntu runner é¢„è£…ï¼‰
          RELEASE_ID=$(jq -r '.id // empty' /tmp/release.json 2>/dev/null || echo "")
          
          if [ -z "$RELEASE_ID" ]; then
            echo "jq extraction failed, trying python3..."
            RELEASE_ID=$(python3 -c "import sys, json; print(json.load(open('/tmp/release.json'))['id'])" 2>/dev/null || echo "")
          fi
          
          if [ -z "$RELEASE_ID" ]; then
            echo "python3 failed, trying grep..."
            RELEASE_ID=$(grep -o '"id":[0-9]*' /tmp/release.json | head -1 | grep -o '[0-9]*')
          fi
          
          if [ -z "$RELEASE_ID" ]; then
            echo "âŒ Error: Failed to extract release ID from response"
            exit 1
          fi
          
          echo "release_id=$RELEASE_ID" >> $GITHUB_OUTPUT
          echo "âœ… Gitee Release created successfully with ID: $RELEASE_ID"

  # Windows ç»¿è‰²ç‰ˆä¸Šä¼ åˆ° Gitee
  sync-windows-portable-to-gitee:
    name: Upload Windows Portable to Giteeï¼ˆä¸Šä¼  Windows ç»¿è‰²ç‰ˆåˆ° Giteeï¼‰
    if: github.event_name == 'release' && needs.build-windows-portable.result == 'success'
    needs: [ create-gitee-release, build-windows-portable ]
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
      - name: Download Windows Portable artifactï¼ˆä¸‹è½½ Windows ç»¿è‰²ç‰ˆäº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          name: EasyPostman-Windows-Portable
          path: artifacts

      - name: Upload Windows Portable to Giteeï¼ˆä¸Šä¼  Windows ç»¿è‰²ç‰ˆåˆ° Giteeï¼‰
        run: |
          RELEASE_ID="${{ needs.create-gitee-release.outputs.release_id }}"
          FILE=$(find artifacts -name "*-portable.zip" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ Windows Portable ZIP file not found!"
            exit 1
          fi
          
          echo "ğŸ“¦ Uploading $(basename $FILE) to Gitee..."
          
          MAX_RETRIES=3
          RETRY_COUNT=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            if curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "file=@$FILE"; then
              echo "âœ… Windows Portable uploaded successfully!"
              exit 0
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              [ $RETRY_COUNT -lt $MAX_RETRIES ] && echo "âš ï¸ Retrying ($RETRY_COUNT/$MAX_RETRIES)..." && sleep 5
            fi
          done
          
          echo "âŒ Failed to upload Windows Portable after $MAX_RETRIES attempts"
          exit 1

  # Windows EXE ä¸Šä¼ åˆ° Gitee
  sync-windows-exe-to-gitee:
    name: Upload Windows EXE to Giteeï¼ˆä¸Šä¼  Windows EXE åˆ° Giteeï¼‰
    if: github.event_name == 'release' && needs.build-windows-exe.result == 'success'
    needs: [ create-gitee-release, build-windows-exe ]
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
      - name: Download Windows EXE artifactï¼ˆä¸‹è½½ Windows EXE äº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          name: EasyPostman-Windows-EXE
          path: artifacts

      - name: Upload Windows EXE to Giteeï¼ˆä¸Šä¼  Windows EXE åˆ° Giteeï¼‰
        run: |
          RELEASE_ID="${{ needs.create-gitee-release.outputs.release_id }}"
          FILE=$(find artifacts -name "*.exe" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ Windows EXE file not found!"
            exit 1
          fi
          
          echo "ğŸ“¦ Uploading $(basename $FILE) to Gitee..."
          
          MAX_RETRIES=3
          RETRY_COUNT=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            if curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "file=@$FILE"; then
              echo "âœ… Windows EXE uploaded successfully!"
              exit 0
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              [ $RETRY_COUNT -lt $MAX_RETRIES ] && echo "âš ï¸ Retrying ($RETRY_COUNT/$MAX_RETRIES)..." && sleep 5
            fi
          done
          
          echo "âŒ Failed to upload Windows EXE after $MAX_RETRIES attempts"
          exit 1

  # macOS ARM ä¸Šä¼ åˆ° Gitee
  sync-macos-to-gitee:
    name: Upload macOS ARM to Giteeï¼ˆä¸Šä¼  macOS ARM åˆ° Giteeï¼‰
    if: github.event_name == 'release' && needs.build-macos-arm.result == 'success'
    needs: [ create-gitee-release, build-macos-arm ]
    runs-on: ubuntu-latest
    continue-on-error: true

    steps:
      - name: Download macOS ARM artifactï¼ˆä¸‹è½½ macOS ARM äº§ç‰©ï¼‰
        uses: actions/download-artifact@v4
        with:
          name: EasyPostman-macOS-ARM-DMG
          path: artifacts

      - name: Upload macOS ARM to Giteeï¼ˆä¸Šä¼  macOS ARM åˆ° Giteeï¼‰
        run: |
          RELEASE_ID="${{ needs.create-gitee-release.outputs.release_id }}"
          FILE=$(find artifacts -name "*-macos-arm64.dmg" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ macOS ARM DMG file not found!"
            exit 1
          fi
          
          echo "ğŸ Uploading $(basename $FILE) to Gitee..."
          
          MAX_RETRIES=3
          RETRY_COUNT=0
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ]; do
            if curl -X POST "https://gitee.com/api/v5/repos/lakernote/easy-postman/releases/$RELEASE_ID/attach_files" \
              -F "access_token=${{ secrets.GITEE_TOKEN }}" \
              -F "file=@$FILE"; then
              echo "âœ… macOS ARM uploaded successfully!"
              exit 0
            else
              RETRY_COUNT=$((RETRY_COUNT + 1))
              [ $RETRY_COUNT -lt $MAX_RETRIES ] && echo "âš ï¸ Retrying ($RETRY_COUNT/$MAX_RETRIES)..." && sleep 5
            fi
          done
          
          echo "âŒ Failed to upload macOS ARM after $MAX_RETRIES attempts"
          exit 1

  # æ±‡æ€»ç»“æœ
  sync-summary:
    name: Sync Summaryï¼ˆåŒæ­¥æ±‡æ€»ï¼‰
    if: |
      github.event_name == 'release' &&
      always()
    needs: [ check-any-build-success, create-gitee-release, sync-windows-portable-to-gitee, sync-windows-exe-to-gitee, sync-macos-to-gitee ]
    runs-on: ubuntu-latest

    steps:
      - name: Summaryï¼ˆæ±‡æ€»ï¼‰
        run: |
          echo "ğŸ“Š Gitee Release åŒæ­¥å®Œæˆï¼"
          
          CHECK_STATUS="${{ needs.check-any-build-success.result }}"
          RELEASE_STATUS="${{ needs.create-gitee-release.result }}"
          
          echo ""
          echo "ğŸ” æ„å»ºæ£€æŸ¥ç»“æœ: $CHECK_STATUS"
          echo "ğŸ“ Gitee Release åˆ›å»º: $RELEASE_STATUS"
          
          if [ "$RELEASE_STATUS" == "success" ]; then
            echo "ğŸ“ Release URL: https://gitee.com/lakernote/easy-postman/releases/${{ needs.create-gitee-release.outputs.tag_name }}"
          fi
          
          echo ""
          echo "å·²åŒæ­¥åˆ° Gitee çš„æ–‡ä»¶ï¼š"
          echo "  ğŸ“¦ Windows Portable (ç»¿è‰²ç‰ˆ) - ${{ needs.sync-windows-portable-to-gitee.result }}"
          echo "  ğŸªŸ Windows EXE (å®‰è£…åŒ…) - ${{ needs.sync-windows-exe-to-gitee.result }}"
          echo "  ğŸ macOS Apple Silicon (ARM64) - ${{ needs.sync-macos-to-gitee.result }}"
          echo ""
          echo "ğŸ’¡ å…¶ä»–å¹³å°ï¼ˆStandalone JARã€macOS Intelã€Ubuntu DEBï¼‰ä»…åœ¨ GitHub Release æä¾›"
          echo ""
          
          PORTABLE_STATUS="${{ needs.sync-windows-portable-to-gitee.result }}"
          EXE_STATUS="${{ needs.sync-windows-exe-to-gitee.result }}"
          MACOS_STATUS="${{ needs.sync-macos-to-gitee.result }}"
          
          SUCCESS_COUNT=0
          [ "$PORTABLE_STATUS" == "success" ] && SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
          [ "$EXE_STATUS" == "success" ] && SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
          [ "$MACOS_STATUS" == "success" ] && SUCCESS_COUNT=$((SUCCESS_COUNT + 1))
          
          echo "ğŸ“ˆ æˆåŠŸä¸Šä¼ : $SUCCESS_COUNT ä¸ªå¹³å°"
          
          if [ "$CHECK_STATUS" == "failure" ]; then
            echo "âŒ æ‰€æœ‰æ„å»ºéƒ½å¤±è´¥ï¼Œæœªåˆ›å»º Gitee Release"
            exit 1
          elif [ $SUCCESS_COUNT -eq 0 ] && [ "$RELEASE_STATUS" == "success" ]; then
            echo "âš ï¸  Gitee Release å·²åˆ›å»ºï¼Œä½†æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å¤±è´¥"
          elif [ $SUCCESS_COUNT -gt 0 ]; then
            echo "âœ… Gitee Release åˆ›å»ºæˆåŠŸï¼Œå·²ä¸Šä¼  $SUCCESS_COUNT ä¸ªå¹³å°çš„æ–‡ä»¶"
          fi
